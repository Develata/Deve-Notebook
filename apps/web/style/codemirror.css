/* Loading Overlay (加载覆盖层) */
#loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: #f8fafc;
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: sans-serif;
  color: #64748b;
}
.hidden {
  display: none !important;
}

/* CodeMirror Overrides (CodeMirror 覆盖样式) */
.cm-editor {
  height: 100%;
}
.cm-scroller {
  overflow: auto;
}

/* Editor Content (编辑器内容区域) */
.cm-content {
  font-family: "Inter", sans-serif;
  font-size: 16px;
  line-height: 1.6;       /* [Layout] 全局行高 */
  padding: 2rem;          /* [Layout] 内容内边距 */
  max-width: 800px;       /* [Layout] 最大阅读宽度 */
  margin: 0 auto;         /* [Layout] 居中对齐 */
  padding-bottom: 5rem;   /* [Layout] 底部留白 (以便最后一行不贴底) */
  overflow-wrap: anywhere; /* [Fix] 强制长单词换行 */
}

/* Syntax Hiding (隐藏 Markdown 语法标记) */
.cm-syntax-hidden {
  display: none !important;
}

/* Math Widget (数学公式组件) */
.cm-math-widget {
  display: inline-block;
  background: #eee;
  padding: 0 4px;
  border-radius: 4px;
  cursor: pointer;
}
/* Block Math (行间公式) */
/* [FIX] 移除 margin，改由 JS wrapper + padding 控制间距 */
/* 为了支持 block: true，需使用 padding（margin 不计入 offsetHeight） */
.cm-math-widget.cm-block-math {
  display: block;
  text-align: center;     /* [Layout] 居中显示 */
  /* margin: 1em 0; -- 已移除，改用 wrapper padding */
}

/* 嵌套行间公式样式 (Nested Block Math) */
/* 嵌套行间公式样式 (Nested Block Math) */
/* 与 blockquote-depth 使用相同的样式策略：Padding + Gradient */

/* Depth 1 */
.cm-nested-math-depth-1 {
  margin-left: 0 !important;
  padding-left: 1.5rem !important;
  border-left: none !important;
  background-color: #f8fafc !important; /* 统一底色 */
  background-image: linear-gradient(to right, #cbd5e1 3px, transparent 3px) !important;
}

/* Depth 2 */
.cm-nested-math-depth-2 {
  margin-left: 0 !important;
  padding-left: 3rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 1.5rem, #94a3b8 1.5rem, #94a3b8 calc(1.5rem + 3px), transparent calc(1.5rem + 3px)) !important;
}

/* Depth 3 */
.cm-nested-math-depth-3 {
  margin-left: 0 !important;
  padding-left: 4.5rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 3rem, #64748b 3rem, #64748b calc(3rem + 3px), transparent calc(3rem + 3px)) !important;
}

/* Depth 4 */
.cm-nested-math-depth-4 {
  margin-left: 0 !important;
  padding-left: 6rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 4.5rem, #475569 4.5rem, #475569 calc(4.5rem + 3px), transparent calc(4.5rem + 3px)) !important;
}

/* Depth 5 */
.cm-nested-math-depth-5 {
  margin-left: 0 !important;
  padding-left: 7.5rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 6rem, #334155 6rem, #334155 calc(6rem + 3px), transparent calc(6rem + 3px)) !important;
}

/* Depth 6 */
.cm-nested-math-depth-6 {
  margin-left: 0 !important;
  padding-left: 9rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 7.5rem, #1e293b 7.5rem, #1e293b calc(7.5rem + 3px), transparent calc(7.5rem + 3px)) !important;
}

/* Depth 7 */
.cm-nested-math-depth-7 {
  margin-left: 0 !important;
  padding-left: 10.5rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 9rem, #0f172a 9rem, #0f172a calc(9rem + 3px), transparent calc(9rem + 3px)) !important;
}

/* Depth 8 */
.cm-nested-math-depth-8 {
  margin-left: 0 !important;
  padding-left: 12rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 10.5rem, #000000 10.5rem, #000000 calc(10.5rem + 3px), transparent calc(10.5rem + 3px)) !important;
}

/* Depth 9 */
.cm-nested-math-depth-9 {
  margin-left: 0 !important;
  padding-left: 13.5rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 12rem, #000000 12rem, #000000 calc(12rem + 3px), transparent calc(12rem + 3px)) !important;
}

/* Depth 10 */
.cm-nested-math-depth-10 {
  margin-left: 0 !important;
  padding-left: 15rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 13.5rem, #000000 13.5rem, #000000 calc(13.5rem + 3px), transparent calc(13.5rem + 3px)) !important;
}

/* Frontmatter (元数据块) */
.cm-frontmatter-block {
  background-color: #f8f9fa; /* [Style] 浅灰背景 (匹配代码块) */
  font-family:
    "Menlo", "Monaco", "Consolas", "Liberation Mono", "Courier New", monospace;
  font-size: 0.85em;      /* [Style] 稍小的字号 */
  color: #64748b;
}

.cm-frontmatter-delim {
  color: #cbd5e1;
  font-weight: bold;
}

/* Checkbox Widget (复选框组件) */
.cm-checkbox-widget {
  margin-right: 0.5em;    /* [Layout] 右侧间距 */
  vertical-align: middle;
}

/* Table Widget (表格组件) */
/* [FIX] 移除 margin，改由 JS wrapper + padding 控制间距 */
/* margin 不计入 offsetHeight，会导致 CodeMirror 行号错位 */
.cm-table-widget {
  width: 100%;            /* [Layout] 宽度占满容器 */
  border-collapse: collapse;
  /* margin: 1em 0; -- 已移除，改用 wrapper padding */
  font-size: 14px;
}
.cm-table-widget th,
.cm-table-widget td {
  border: 1px solid #e2e8f0;
  padding: 8px 12px;      /* [Layout] 单元格内边距 */
}
.cm-table-widget th {
  background: #f1f5f9;
  font-weight: 600;
  color: #334155;
}
.cm-table-widget tbody tr:nth-child(even) {
  background: #f8fafc;    /* [Style] 隔行变色 */
}
.cm-table-widget tbody tr:hover {
  background: #e0f2fe;    /* [Style] 悬停高亮 */
}

/* Code Block Highlight (代码块高亮 - RStudio 风格) */
.cm-code-block-line {
  background-color: #f8f9fa; /* [Style] 浅灰背景 */
  border-radius: 0;
  /* [Note] 高度由内容和全局 line-height 决定，无额外 padding */
}

/* Optional: Rounded Corners for Start/End (代码块首尾圆角) */
.cm-code-block-start {
  border-top-left-radius: 4px;
  border-top-right-radius: 4px;
}
.cm-code-block-end {
  border-bottom-left-radius: 4px;
  border-bottom-right-radius: 4px;
}

/* Blockquote Styling (引用块样式 - RStudio 风格) */
.cm-blockquote-line {
  background-color: #f8f9fa; /* [Style] 匹配代码块背景 */
  border-left: 4px solid #cbd5e1; /* [Style] 左侧装饰线 */
}

/* Adjusting line padding for blockquotes (引用块内文本缩进) */
.cm-blockquote-line {
  padding-left: 1rem; /* [Layout] 内容缩进 (避免紧贴左侧线) */
}

/* 递进式引用块边框 (Simplified: Single Background, Padding Indent) */
/* 核心改动：
   1. margin-left: 0 (确保背景色铺满左侧，消除白色空隙)
   2. padding-left: 深度 * 1.5rem
   3. background-color: 统一浅灰色 (只在第一层渲染底色，之后保持一致)
   4. border-left: 使用 linear-gradient 模拟垂直线条
*/

/* Depth 1 */
.cm-line.cm-blockquote-depth-1 {
  margin-left: 0 !important;
  padding-left: 1.5rem !important;
  border-left: none !important;
  background-color: #f8fafc !important; /* 统一底色 */
  background-image: linear-gradient(to right, #cbd5e1 3px, transparent 3px) !important;
}

/* Depth 2 */
.cm-line.cm-blockquote-depth-2 {
  margin-left: 0 !important;
  padding-left: 3rem !important; /* 1.5 * 2 */
  border-left: none !important;
  background-color: #f8fafc !important; /* 保持与 Depth 1 一致的底色 */
  /* 在 1.5rem 处画第二条线 */
  background-image: linear-gradient(to right, transparent 1.5rem, #94a3b8 1.5rem, #94a3b8 calc(1.5rem + 3px), transparent calc(1.5rem + 3px)) !important;
}

/* Depth 3 */
.cm-line.cm-blockquote-depth-3 {
  margin-left: 0 !important;
  padding-left: 4.5rem !important; /* 1.5 * 3 */
  border-left: none !important;
  background-color: #f8fafc !important;
  /* 在 3rem 处画第三条线 */
  background-image: linear-gradient(to right, transparent 3rem, #64748b 3rem, #64748b calc(3rem + 3px), transparent calc(3rem + 3px)) !important;
}

/* Depth 4 */
.cm-line.cm-blockquote-depth-4 {
  margin-left: 0 !important;
  padding-left: 6rem !important; /* 1.5 * 4 */
  border-left: none !important;
  background-color: #f8fafc !important;
  /* 在 4.5rem 处画第四条线 */
  background-image: linear-gradient(to right, transparent 4.5rem, #475569 4.5rem, #475569 calc(4.5rem + 3px), transparent calc(4.5rem + 3px)) !important;
}

/* Depth 5 */
.cm-line.cm-blockquote-depth-5 {
  margin-left: 0 !important;
  padding-left: 7.5rem !important; /* 1.5 * 5 */
  border-left: none !important;
  background-color: #f8fafc !important;
  /* 在 6rem 处画第五条线 */
  background-image: linear-gradient(to right, transparent 6rem, #334155 6rem, #334155 calc(6rem + 3px), transparent calc(6rem + 3px)) !important;
}

/* Depth 6 */
.cm-line.cm-blockquote-depth-6 {
  margin-left: 0 !important;
  padding-left: 9rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 7.5rem, #1e293b 7.5rem, #1e293b calc(7.5rem + 3px), transparent calc(7.5rem + 3px)) !important;
}

/* Depth 7 */
.cm-line.cm-blockquote-depth-7 {
  margin-left: 0 !important;
  padding-left: 10.5rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 9rem, #0f172a 9rem, #0f172a calc(9rem + 3px), transparent calc(9rem + 3px)) !important;
}

/* Depth 8 */
.cm-line.cm-blockquote-depth-8 {
  margin-left: 0 !important;
  padding-left: 12rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 10.5rem, #000000 10.5rem, #000000 calc(10.5rem + 3px), transparent calc(10.5rem + 3px)) !important;
}

/* Depth 9 */
.cm-line.cm-blockquote-depth-9 {
  margin-left: 0 !important;
  padding-left: 13.5rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 12rem, #000000 12rem, #000000 calc(12rem + 3px), transparent calc(12rem + 3px)) !important;
}

/* Depth 10 */
.cm-line.cm-blockquote-depth-10 {
  margin-left: 0 !important;
  padding-left: 15rem !important;
  border-left: none !important;
  background-color: #f8fafc !important;
  background-image: linear-gradient(to right, transparent 13.5rem, #000000 13.5rem, #000000 calc(13.5rem + 3px), transparent calc(13.5rem + 3px)) !important;
}

/* [FIX] 代码块背景填充与缩进 */
/* 
   为了让代码块背景色“缩进”（即只覆盖内容区，不覆盖左侧引用边框区域），
   我们需要利用 background-image 的多层渐变。
   底层：引用块统一底色 (background-color)
   上层：1. 边框线 (保留之前的 gradient)
        2. 代码块背景色 (使用 gradient 从 padding 处开始渲染)
*/

/* 通用代码块样式 (无嵌套时) */
.cm-line.cm-code-block-line {
    background-color: rgb(229, 231, 232) !important;
    margin-left: 0 !important;
}

/* 嵌套代码块特定样式 (Depth 1-5) */
/* 注意：必须重写 background-image 以包含边框和代码背景 */

/* Depth 1: Padding 1.5rem */
.cm-line.cm-blockquote-depth-1.cm-code-block-line {
    background-color: #f8fafc !important; /* 引用底色 */
    background-image: 
        linear-gradient(to right, #cbd5e1 3px, transparent 3px), /* 边框 */
        linear-gradient(to right, transparent 1.5rem, rgb(229, 231, 232) 1.5rem) !important; /* 代码背景 */
}

/* Depth 2: Padding 3rem */
.cm-line.cm-blockquote-depth-2.cm-code-block-line {
    background-color: #f8fafc !important;
    background-image: 
        linear-gradient(to right, transparent 1.5rem, #94a3b8 1.5rem, #94a3b8 calc(1.5rem + 3px), transparent calc(1.5rem + 3px)),
        linear-gradient(to right, transparent 3rem, rgb(229, 231, 232) 3rem) !important;
}

/* Depth 3: Padding 4.5rem */
.cm-line.cm-blockquote-depth-3.cm-code-block-line {
    background-color: #f8fafc !important;
    background-image: 
        linear-gradient(to right, transparent 3rem, #64748b 3rem, #64748b calc(3rem + 3px), transparent calc(3rem + 3px)),
        linear-gradient(to right, transparent 4.5rem, rgb(229, 231, 232) 4.5rem) !important;
}

/* Depth 4: Padding 6rem */
.cm-line.cm-blockquote-depth-4.cm-code-block-line {
    background-color: #f8fafc !important;
    background-image: 
        linear-gradient(to right, transparent 4.5rem, #475569 4.5rem, #475569 calc(4.5rem + 3px), transparent calc(4.5rem + 3px)),
        linear-gradient(to right, transparent 6rem, rgb(229, 231, 232) 6rem) !important;
}

/* Depth 5: Padding 7.5rem */
.cm-line.cm-blockquote-depth-5.cm-code-block-line {
    background-color: #f8fafc !important;
    background-image: 
        linear-gradient(to right, transparent 6rem, #334155 6rem, #334155 calc(6rem + 3px), transparent calc(6rem + 3px)),
        linear-gradient(to right, transparent 7.5rem, rgb(229, 231, 232) 7.5rem) !important;
}

/* Depth 6: Padding 9rem */
.cm-line.cm-blockquote-depth-6.cm-code-block-line {
    background-color: #f8fafc !important;
    background-image: 
        linear-gradient(to right, transparent 7.5rem, #1e293b 7.5rem, #1e293b calc(7.5rem + 3px), transparent calc(7.5rem + 3px)),
        linear-gradient(to right, transparent 9rem, rgb(229, 231, 232) 9rem) !important;
}

/* Depth 7: Padding 10.5rem */
.cm-line.cm-blockquote-depth-7.cm-code-block-line {
    background-color: #f8fafc !important;
    background-image: 
        linear-gradient(to right, transparent 9rem, #0f172a 9rem, #0f172a calc(9rem + 3px), transparent calc(9rem + 3px)),
        linear-gradient(to right, transparent 10.5rem, rgb(229, 231, 232) 10.5rem) !important;
}

/* Depth 8: Padding 12rem */
.cm-line.cm-blockquote-depth-8.cm-code-block-line {
    background-color: #f8fafc !important;
    background-image: 
        linear-gradient(to right, transparent 10.5rem, #000000 10.5rem, #000000 calc(10.5rem + 3px), transparent calc(10.5rem + 3px)),
        linear-gradient(to right, transparent 12rem, rgb(229, 231, 232) 12rem) !important;
}

/* Depth 9: Padding 13.5rem */
.cm-line.cm-blockquote-depth-9.cm-code-block-line {
    background-color: #f8fafc !important;
    background-image: 
        linear-gradient(to right, transparent 12rem, #000000 12rem, #000000 calc(12rem + 3px), transparent calc(12rem + 3px)),
        linear-gradient(to right, transparent 13.5rem, rgb(229, 231, 232) 13.5rem) !important;
}

/* Depth 10: Padding 15rem */
.cm-line.cm-blockquote-depth-10.cm-code-block-line {
    background-color: #f8fafc !important;
    background-image: 
        linear-gradient(to right, transparent 13.5rem, #000000 13.5rem, #000000 calc(13.5rem + 3px), transparent calc(13.5rem + 3px)),
        linear-gradient(to right, transparent 15rem, rgb(229, 231, 232) 15rem) !important;
}

/* 列表圆点样式 (List Bullet Styling) */
.cm-list-bullet {
  color: #64748b;
  font-size: 0.5em;
  display: inline-block;
  position: relative;
  top: -0.2em;           /* [Fix] 微调向上偏移以居中 */
  margin-right: 0.4em;
}
.cm-list-ordered {
  color: #3b82f6;
  font-weight: 600;
  font-size: 0.9em;
}

/* Previous .cm-quote styles cleanup (清理旧的引用样式) */
.cm-quote {
  color: #64748b;
}


/* Inline Code Styling (行内代码样式) */
.cm-inline-code {
  background-color: #f1f5f9; /* slate-100 */
  color: #1e293b;            /* slate-800 */
  padding: 0.2em 0.4em;      /* [Layout] 内边距 */
  border-radius: 4px;
  font-family:
    "Menlo", "Monaco", "Consolas", "Liberation Mono", "Courier New", monospace;
  font-size: 1em; /* 稍大一点以便阅读 */
}

/* Explicit Markdown Styling (Markdown 基础样式) */
.cm-strong {
  font-weight: bold;
}
.cm-em {
  font-style: italic;
}
.cm-strikethrough {
  text-decoration: line-through;
}

/* Headings (标题样式) */
.cm-h1 {
  font-size: 2em;
  font-weight: bold;
  line-height: 1.2;
}
.cm-h2 {
  font-size: 1.5em;
  font-weight: bold;
  line-height: 1.3;
}
.cm-h3 {
  font-size: 1.25em;
  font-weight: bold;
  line-height: 1.4;
}
.cm-h4 {
  font-size: 1.1em;
  font-weight: bold;
}
.cm-h5 {
  font-size: 1em;
  font-weight: bold;
}
.cm-h6 {
  font-size: 0.9em;
  font-weight: bold;
  color: #64748b;
}

/* Links (链接样式) */
.cm-link {
  color: #2563eb;
  text-decoration: none;
}
.cm-link:hover {
  text-decoration: underline;
}
.cm-url {
  color: #94a3b8;
  font-family: monospace;
}

/* Blockquote Text (引用文本颜色) */
.cm-blockquote {
  color: #475569;
  font-style: italic;
}

/* Horizontal Rule (Source Text) (水平分割线源码) */
.cm-hr {
  color: #cbd5e1;
  font-weight: bold;
}

/* Rendered Horizontal Rule (渲染后的水平分割线) */
.cm-hr-rendered {
  color: transparent !important;   /* [Hack] 隐藏原文本颜色 */
  background-color: #cbd5e1;       /* [Style] 线条颜色 */

  display: inline-block;           /* [Layout] 布局模式 */
  width: 100%;                     /* [Layout] 全宽 */
  height: 2px;                     /* [Layout] 线条高度 */

  margin: 1em 0;                   /* [Layout] 上下间距 */
  line-height: 0px;                /* [Hack] 压扁行高 */
  overflow: hidden;                /* [Hack] 隐藏溢出内容 */
  vertical-align: middle;

  text-indent: -9999px;            /* [Hack] 将文本推移出可视区域 */
}

/* 
   Selection Styling (Native Browser Selection)
   使用浏览器原生选择机制，通过 ::selection 伪元素进行样式化
   这种方法比 CodeMirror 的 drawSelection() 更可靠，不会在滚动时消失
*/

/* 编辑器内的文本选择样式 */
.cm-editor ::selection {
  background-color: rgba(59, 130, 246, 0.4) !important;
  color: inherit;
}

.cm-editor ::-moz-selection {
  background-color: rgba(59, 130, 246, 0.4) !important;
  color: inherit;
}

/* 确保特殊块内的选择也可见 (代码块、引用、Frontmatter) */
.cm-code-block-line ::selection,
.cm-blockquote-line ::selection,
.cm-frontmatter-block ::selection {
  background-color: rgba(59, 130, 246, 0.5) !important;
}

.cm-code-block-line ::-moz-selection,
.cm-blockquote-line ::-moz-selection,
.cm-frontmatter-block ::-moz-selection {
  background-color: rgba(59, 130, 246, 0.5) !important;
}

/* 确保光标颜色正常 */
.cm-content {
  caret-color: #333;
}
