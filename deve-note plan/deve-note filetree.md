# Deve-Note ä»£ç ç›®å½•ç»“æ„ (File Tree)

æœ¬æ–‡æ¡£å±•ç¤ºäº† `Deve-Note` é¡¹ç›®çš„æ ¸å¿ƒä»£ç ç»“æ„åŠå…¶åŠŸèƒ½è¯´æ˜ã€‚

## ğŸ“¦ Project Root

- **`Cargo.toml`**: Workspace é…ç½®æ–‡ä»¶ï¼Œç®¡ç† workspace members (`apps/*`, `crates/*`).
- **`deve-note plan/`**: é¡¹ç›®è§„åˆ’æ–‡æ¡£ç›®å½•.

---

## ğŸ“‚ crates/core (æ ¸å¿ƒåº“)

å®ç°äº†ä¸šåŠ¡é€»è¾‘æ— å…³çš„æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬å­˜å‚¨ã€åŒæ­¥ã€åè®®å®šä¹‰ã€‚

- **`src/`**
  - **`config.rs`**: **é…ç½®ç®¡ç†**ã€‚åŠ è½½ç¯å¢ƒå˜é‡ (`DEVE_*`) å¹¶è§£æä¸ºé…ç½®å¯¹è±¡ã€‚
  - **`error.rs`**: **é”™è¯¯å®šä¹‰**ã€‚ç»Ÿä¸€çš„ `AppError` æšä¸¾ã€‚
  - **`models.rs`**: **æ•°æ®æ¨¡å‹**ã€‚å®šä¹‰ `DocId`, `PeerId`, `VersionVector` ç­‰åŸºç¡€ç±»å‹ã€‚
  - **`protocol.rs`**: **é€šä¿¡åè®®**ã€‚å®šä¹‰ WebSocket ä¼ è¾“çš„ `ClientMessage` å’Œ `ServerMessage`ã€‚
  - **`state.rs`**: **çŠ¶æ€æœº**ã€‚CRDT æ ¸å¿ƒé€»è¾‘ï¼ŒåŒ…æ‹¬ Operations çš„åº”ç”¨å’Œå†²çªæ¶ˆè§£ (DAG Reconstruct)ã€‚
  - **`vfs.rs`**: **è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ**ã€‚å¤„ç† File åˆ° DocId çš„æ˜ å°„ï¼Œç»´æŠ¤ Inode ç¨³å®šæ€§ã€‚
  - **`watcher.rs`**: **æ–‡ä»¶ç›‘å¬**ã€‚ç›‘æ§ Vault ç›®å½•çš„æ–‡ä»¶å˜æ›´äº‹ä»¶ã€‚
  - **`ledger/`**: **å­˜å‚¨æ¨¡å—**
    - **`mod.rs`**: æ¨¡å—å…¥å£ï¼Œ`RepoManager` å®ç°ã€‚
    - **`schema.rs`**: Redb æ•°æ®åº“è¡¨å®šä¹‰ (`DOCID_TO_PATH`, `LEDGER_OPS` ç­‰)ã€‚
    - **`ops.rs`**: å¯¹ Operation æ—¥å¿—çš„åº•å±‚è¯»å†™ã€‚
    - **`snapshot.rs`**: å¿«ç…§ç®¡ç†é€»è¾‘ (`SNAPSHOT_INDEX`, `SNAPSHOT_DATA`)ã€‚
    - **`source_control.rs`**: ç‰ˆæœ¬æ§åˆ¶é€»è¾‘ (Stage, Commit)ã€‚
    - **`shadow/`**: å½±å­ä»“åº“é€»è¾‘ (Shadow Repos)ã€‚
  - **`sync/`**: **åŒæ­¥æ¨¡å—**
    - **`engine.rs`**: åŒæ­¥å¼•æ“ï¼Œè®¡ç®— Version Vector å·®å¼‚ã€‚
    - **`buffer.rs`**: Op ä¹±åºç¼“å†²æ± ã€‚
  - **`plugin/`**: **æ’ä»¶æ¨¡å—**
    - **`runtime.rs`**: æ’ä»¶è¿è¡Œæ—¶ (Rhai/WASM)ã€‚

---

## ğŸ“‚ apps/cli (åç«¯/CLI)

æä¾›å‘½ä»¤è¡Œå·¥å…·å’Œ WebSocket åç«¯æœåŠ¡ã€‚

- **`src/`**
  - **`main.rs`**: **ç¨‹åºå…¥å£**ã€‚è§£æå‘½ä»¤è¡Œå‚æ•° (`serve`, `scan`, `init` ç­‰)ã€‚
  - **`commands/`**: **å­å‘½ä»¤å®ç°**
    - **`serve.rs`**: å¯åŠ¨ HTTP/WebSocket æœåŠ¡ã€‚
    - **`scan.rs`**: æ‰§è¡Œå…¨é‡æ–‡ä»¶ç´¢å¼•æ‰«æã€‚
    - **`init.rs`**: åˆå§‹åŒ–æ–°çš„ Vaultã€‚
  - **`server/`**: **æœåŠ¡ç«¯é€»è¾‘**
    - **`ws.rs`**: WebSocket è¿æ¥ç®¡ç†ä¸æ¶ˆæ¯è·¯ç”±ã€‚
    - **`handlers/`**: å…·ä½“çš„æ¶ˆæ¯å¤„ç†å™¨ (`document`, `sync` ç­‰)ã€‚

---

## ğŸ“‚ apps/web (å‰ç«¯)

åŸºäº Leptos å’Œ Tailwind CSS çš„ Web å®¢æˆ·ç«¯ã€‚

- **`src/`**
  - **`main.rs`**: Wasm æŒ‚è½½å…¥å£ã€‚
  - **`app.rs`**: **åº”ç”¨ç»„ä»¶**ã€‚å®šä¹‰å…¨å±€å¸ƒå±€ (Layout) å’Œ Contextã€‚
  - **`i18n.rs`**: å›½é™…åŒ–é…ç½®ã€‚
  - **`api/`**: **API å±‚**
    - **`connection.rs`**: WebSocket è¿æ¥çŠ¶æ€ç®¡ç† (é‡è¿æœºåˆ¶)ã€‚
  - **`hooks/`**: **Hooks**
    - **`use_core.rs`**: **æ ¸å¿ƒçŠ¶æ€ä¸­æ¢**ã€‚å°è£…ä¸åç«¯çš„é€šä¿¡æµã€‚
  - **`editor/`**: **ç¼–è¾‘å™¨æ¨¡å—**
    - **`hook.rs`**: CodeMirror å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚
    - **`ffi.rs`**: Wasm Bindings (è°ƒç”¨ JS Adapter)ã€‚
    - **`sync.rs`**: ç¼–è¾‘å™¨å†…å®¹åŒæ­¥é€»è¾‘ã€‚
  - **`components/`**: **UI ç»„ä»¶**
    - **`header.rs`**: é¡¶éƒ¨æ ‡é¢˜æ ã€‚
    - **`activity_bar.rs`**: å·¦ä¾§ä¸€çº§å›¾æ ‡æ ã€‚
    - **`bottom_bar.rs`**: åº•éƒ¨çŠ¶æ€æ ã€‚
    - **`diff_view.rs`**: å·®å¼‚å¯¹æ¯”è§†å›¾ã€‚
    - **`sidebar/`**:
        - **`sidebar.rs`**: ä¾§è¾¹æ å®¹å™¨ã€‚
        - **`sidebar_menu.rs`**: èœå•ç»„ä»¶ã€‚
    - **`search_box/`**: **ç»Ÿä¸€æœç´¢æ¡†**ã€‚å®ç° Command/File/Branch æœç´¢æ¨¡å¼ã€‚
    - **`settings.rs`**: è®¾ç½®æ¨¡æ€æ¡†ã€‚
    - **`source_control/`**: ç‰ˆæœ¬æ§åˆ¶é¢æ¿ç»„ä»¶ã€‚
    - **`branch_switcher/`**: åˆ†æ”¯åˆ‡æ¢ç»„ä»¶ã€‚
    - **`merge_panel.rs`**: æ‰‹åŠ¨åˆå¹¶é¢æ¿ã€‚
    - **`outline.rs`**: æ–‡æ¡£å¤§çº²è§†å›¾ã€‚
