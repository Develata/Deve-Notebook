# 10_i18n.md - 语言篇 (Internationalization)

## 国际化策略 (Internationalization Strategy)

*   **技术选型**：使用 **leptos_i18n**。
    *   **优势**：提供编译时校验 (Compile-time checking)，防止 Key 缺失或类型错误。
*   **UI 文本管理**：
    *   核心 UI 文本 **MUST** 全部使用 `leptos_i18n` 进行管理，严禁硬编码字符串。
*   **Format Handling (格式处理)**:
    *   **Date/Time/Number**: 严禁手动拼装 (e.g., `YYYY-MM-DD`)。**MUST** 使用 `Intl` API (JavaScript) 或 Rust 的 `time` crate 进行本地化格式输出。
*   **Backend Error Handling (后端错误处理)**:
    *   后端 API **MUST NOT** 返回自然语言错误信息 (e.g., "密码错误")。
    *   **MUST** 返回标准错误码 (e.g., `AUTH_INVALID_PASSWORD`)。
    *   前端根据 Error Code 查找 `i18n` 映射表进行展示。

## 语言资源管理 (Resource Management)

*   **Structure**: 采用 Flat JSON 或 TOML 格式存储。
*   **Fallback**: 若当前 Locale 缺失某 Key，**MUST** 自动回退到 `en-US`。
*   **Detection**: 启动时优先级:
    1.  User Config (`locale` setting).
    2.  Browser Preference (`navigator.language`).
    3.  Default (`en-US`).


## 本章相关命令

*   `Global: Toggle Language`: 按顺序在支持的语言列表 (e.g., en -> zh -> ja -> en) 中循环切换界面语言。

## 本章相关配置

*   `locale`: 界面语言设置 (e.g., `en-US`, `zh-CN`).

## I18n Keys 参考 (Reference)

### Source Control (`t::source_control::xxx`)

| Key              | En             | Zh         |
| ---------------- | -------------- | ---------- |
| `title`          | Source Control | 源代码管理 |
| `repositories`   | Repositories   | 存储库     |
| `changes`        | Changes        | 更改       |
| `staged_changes` | Staged Changes | 暂存的更改 |
| `history`        | History        | 历史记录   |
| `graph`          | Graph          | 图形       |

### Common (`t::common::xxx`)

| Key        | En       | Zh       |
| ---------- | -------- | -------- |
| `create`   | Create   | 创建     |
| `new_file` | New File | 新建文件 |

### Header (`t::header::xxx`)

| Key        | En              | Zh       |
| ---------- | --------------- | -------- |
| `settings` | Settings        | 设置     |
| `home`     | Home            | 首页     |
| `open`     | Open Index      | 打开目录 |
| `command`  | Command Palette | 命令面板 |

### Sidebar (`t::sidebar::xxx`)

| Key       | En                 | Zh       |
| --------- | ------------------ | -------- |
| `no_docs` | No documents found | 暂无文档 |

### Settings (`t::settings::xxx`)

| Key           | En                                 | Zh                       |
| ------------- | ---------------------------------- | ------------------------ |
| `title`       | Settings                           | 设置                     |
| `close`       | Close                              | 关闭                     |
| `about`       | About                              | 关于                     |
| `version`     | Version                            | 版本                     |
| `language`    | Language                           | 语言                     |
| `hybrid_mode` | Hybrid Editing                     | 混合编辑                 |
| `hybrid_desc` | Hide Markdown syntax while reading | 阅读时隐藏 Markdown 语法 |
| `coming_soon` | Coming in Phase 6                  | 将在 Phase 6 推出        |

### Bottom Bar (`t::bottom_bar::xxx`)

| Key       | En         | Zh        |
| --------- | ---------- | --------- |
| `words`   | Words      | 字数      |
| `lines`   | Lines      | 行数      |
| `col`     | Col        | 列        |
| `ready`   | Ready      | 就绪      |
| `syncing` | Syncing... | 同步中... |
| `offline` | Offline    | 离线      |

### Playback (`t::playback::xxx`)

| Key     | En       | Zh       |
| ------- | -------- | -------- |
| `label` | PLAYBACK | 回放控制 |

### Command Palette (`t::command_palette::xxx`)

| Key               | En                     | Zh                |
| ----------------- | ---------------------- | ----------------- |
| `placeholder`     | Type a command...      | 输入命令...       |
| `no_results`      | No results found.      | 未找到结果。      |
| `open_settings`   | Open Settings (config) | 打开设置 (config) |
| `toggle_language` | Toggle Language        | 切换语言          |

### Search (`t::search::xxx`)

| Key                   | En                   | Zh                   |
| --------------------- | -------------------- | -------------------- |
| `placeholder_command` | Search commands...   | 搜索命令...          |
| `placeholder_branch`  | Switch branch...     | 切换分支...          |
| `placeholder_file`    | folder/.../file(.md) | 文件夹/.../文件(.md) |

